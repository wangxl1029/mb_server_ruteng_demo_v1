
////////////////////////////////////////////////////////////////////////////////
//
// All Rights Reserved, Copyright(C),2013
// Licenced Material of by zhaoyiwei
// This file is auto generated by IOLibMaker, Do NOT modify
//
////////////////////////////////////////////////////////////////////////////////
//
// SubSystem: NDS_UpdInfoNDS_UpdInfoのデ`タアクセス用のライブラリ
// Class Name:    NDS_UpdInfoNDS_UpdInfoのきzむ用のクラス
//
////////////////////////////////////////////////////////////////////////////////
#include	"InnerCommon.h"
#include	"NDS_UpdInfo_Struct.h"
#include	"NDS_UpdInfo_OutsideRef.h"
#include	"NDS_UpdInfo_InsideRef.h"
#include	"NDS_UpdInfo_FormatStructure.h"
#include	"NDS_UpdInfo_Writer.h"


////////////////////////////////////////////////////////////////////////////////
//
// Function: NDS_UpdInfoNDS_UpdInfoコンストラクタ`
// Detail: NDS_UpdInfoNDS_UpdInfoクラスの初期化
// Return:None
////////////////////////////////////////////////////////////////////////////////
CNDS_UpdInfo_Writer::CNDS_UpdInfo_Writer()
{
}

////////////////////////////////////////////////////////////////////////////////
//
// Function: NDS_UpdInfoNDS_UpdInfoコンストラクタ`
// Detail: NDS_UpdInfoNDS_UpdInfoクラスの初期化
// Return:None
////////////////////////////////////////////////////////////////////////////////
CNDS_UpdInfo_Writer::CNDS_UpdInfo_Writer( SmartPointer<CMyOfstream> &pclStream, SmartPointer<CBaseFormatStructure> &pclFormatStructure )
	: CIOLibBaseWriter( pclStream, pclFormatStructure )
{
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: NDS_UpdInfoNDS_UpdInfoディストラクタ`
// Detail: NDS_UpdInfoNDS_UpdInfoクラスの削除
// Return:None
////////////////////////////////////////////////////////////////////////////////
CNDS_UpdInfo_Writer::~CNDS_UpdInfo_Writer()
{
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: CreateFormatStructure
// Detail: Create meta data class of format for WriteBack.
// Return:int 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
int CNDS_UpdInfo_Writer::CreateFormatStructure( SmartPointer<CBaseFormatStructure> &spclFormatStructure )
{
	spclFormatStructure.CreateEx( Type2Type<CNDS_UpdInfo_FormatStructure>() );
	if( NULL == m_pclFormatStructure.Get() ) {
		assert( 0 );
		return FAILURE;
	}
	return SUCCESS;
}



////////////////////////////////////////////////////////////////////////////////
//
// Function: Write_NDS_UpdCateInfo
// Detail: 当するフォ`マットのNDS_UpdCateInfoレコ`ドをきzむ
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
long CNDS_UpdInfo_Writer::WriteNDS_UpdCateInfo( const CNDS_UpdCateInfo &clNDS_UpdCateInfo )
{
	CFormatStructureNotifier	clNotifier( m_pclFormatStructure, StructType_NDS_UpdInfo_NDS_UpdCateInfo );

	NDS_UpdInfo_CountNDS_UpdCateInfo_InsideRefElem( m_pclFormatStructure );

	if( SUCCESS != m_pclStream->Put1bN( clNDS_UpdCateInfo.m_ucCategoryID ) ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != m_pclStream->Put4bN( clNDS_UpdCateInfo.m_uiDataSize ) ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != m_pclStream->Put4bN( clNDS_UpdCateInfo.m_uiAppendCount ) ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != m_pclStream->Put4bN( clNDS_UpdCateInfo.m_uiDeleteCount ) ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != m_pclStream->Put4bN( clNDS_UpdCateInfo.m_uiModifyCount ) ) {
		assert( 0 );
		return FAILURE;
	}

	return SUCCESS;
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: Write_NDS_UpdateInfo
// Detail: 当するフォ`マットのNDS_UpdateInfoレコ`ドをきzむ
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
long CNDS_UpdInfo_Writer::WriteNDS_UpdateInfo( const CNDS_UpdateInfo &clNDS_UpdateInfo )
{
	CFormatStructureNotifier	clNotifier( m_pclFormatStructure, StructType_NDS_UpdInfo_NDS_UpdateInfo );

	CNDS_UpdInfo_NDS_UpdateInfo_InsideRef 	*pclInsideRef	=	NDS_UpdInfo_GetCurNDS_UpdateInfo_InsideRef( m_pclFormatStructure );

	pclInsideRef->m_ullCategoryCnt_DA	=	m_pclStream->GetDA();
	if( SUCCESS != m_pclStream->Put1bN( clNDS_UpdateInfo.m_ucCategoryCnt ) ) {
		assert( 0 );
		return FAILURE;
	}

 uint uiNDS_UpdateInfoUpdInfoList_CUR_NO	= 0;
	for( uiNDS_UpdateInfoUpdInfoList_CUR_NO = 0; uiNDS_UpdateInfoUpdInfoList_CUR_NO < (uint)(clNDS_UpdateInfo.m_vclUpdInfoList.size()); ++uiNDS_UpdateInfoUpdInfoList_CUR_NO ) {
		if( SUCCESS != WriteNDS_UpdCateInfo( clNDS_UpdateInfo.m_vclUpdInfoList[uiNDS_UpdateInfoUpdInfoList_CUR_NO] ) ) {
			assert( 0 );
			return FAILURE;
		}
	}


	return SUCCESS;
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: Write_NDS_UpdRegionInfo
// Detail: 当するフォ`マットのNDS_UpdRegionInfoレコ`ドをきzむ
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
long CNDS_UpdInfo_Writer::WriteNDS_UpdRegionInfo( const CNDS_UpdRegionInfo &clNDS_UpdRegionInfo )
{
	CFormatStructureNotifier	clNotifier( m_pclFormatStructure, StructType_NDS_UpdInfo_NDS_UpdRegionInfo );

	CNDS_UpdInfo_NDS_UpdRegionInfo_InsideRef 	*pclInsideRef	=	NDS_UpdInfo_GetCurNDS_UpdRegionInfo_InsideRef( m_pclFormatStructure );

	if( SUCCESS != m_pclStream->Put2bN( clNDS_UpdRegionInfo.m_usVersion ) ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != WriteNDS_UpdateInfo( clNDS_UpdRegionInfo.m_clUpdateInfo ) ) {
		assert( 0 );
		return FAILURE;
	}

	return SUCCESS;
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: CalcSize_NDS_UpdCateInfo
// Detail: NDS_UpdCateInfoをきzむSizeを算する
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
uint64 CNDS_UpdInfo_Writer::CalSizeNDS_UpdCateInfo( const CNDS_UpdCateInfo &clNDS_UpdCateInfo )
{
	uint64	ullResultSize	=	0;
	ullResultSize	+=	CMyOfstream::CalSize1bN( clNDS_UpdCateInfo.m_ucCategoryID );

	ullResultSize	+=	CMyOfstream::CalSize4bN( clNDS_UpdCateInfo.m_uiDataSize );

	ullResultSize	+=	CMyOfstream::CalSize4bN( clNDS_UpdCateInfo.m_uiAppendCount );

	ullResultSize	+=	CMyOfstream::CalSize4bN( clNDS_UpdCateInfo.m_uiDeleteCount );

	ullResultSize	+=	CMyOfstream::CalSize4bN( clNDS_UpdCateInfo.m_uiModifyCount );

	return ullResultSize;
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: CalcSize_NDS_UpdateInfo
// Detail: NDS_UpdateInfoをきzむSizeを算する
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
uint64 CNDS_UpdInfo_Writer::CalSizeNDS_UpdateInfo( const CNDS_UpdateInfo &clNDS_UpdateInfo )
{
	uint64	ullResultSize	=	0;
	ullResultSize	+=	CMyOfstream::CalSize1bN( clNDS_UpdateInfo.m_ucCategoryCnt );

 uint uiNDS_UpdateInfoUpdInfoList_CUR_NO	= 0;
	for( uiNDS_UpdateInfoUpdInfoList_CUR_NO = 0; uiNDS_UpdateInfoUpdInfoList_CUR_NO < (uint)(clNDS_UpdateInfo.m_vclUpdInfoList.size()); ++uiNDS_UpdateInfoUpdInfoList_CUR_NO ) {
		ullResultSize	+=	CalSizeNDS_UpdCateInfo( clNDS_UpdateInfo.m_vclUpdInfoList[uiNDS_UpdateInfoUpdInfoList_CUR_NO] );
	}

	return ullResultSize;
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: CalcSize_NDS_UpdRegionInfo
// Detail: NDS_UpdRegionInfoをきzむSizeを算する
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
uint64 CNDS_UpdInfo_Writer::CalSizeNDS_UpdRegionInfo( const CNDS_UpdRegionInfo &clNDS_UpdRegionInfo )
{
	uint64	ullResultSize	=	0;
	ullResultSize	+=	CMyOfstream::CalSize2bN( clNDS_UpdRegionInfo.m_usVersion );

	ullResultSize	+=	CalSizeNDS_UpdateInfo( clNDS_UpdRegionInfo.m_clUpdateInfo );

	return ullResultSize;
}

////////////////////////////////////////////////////////////////////////////////
//
// Function: SolveInsideRef
// Detail: 当するフォ`マットの中のvS(offsetと数など)ををすべてWriteBack
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////

int CNDS_UpdInfo_Writer::SolveInsideRef()
{
	CNDS_UpdInfo_NDS_UpdRegionInfo_InsideRef		&clNDS_UpdRegionInfo	=	((CNDS_UpdInfo_FormatStructure*)m_pclFormatStructure.Get())->GetInsideRefInfo();
	{
		CNDS_UpdInfo_NDS_UpdateInfo_InsideRef	&clNDS_UpdRegionInfoUpdateInfo	=	clNDS_UpdRegionInfo.m_clUpdateInfo;
		if( SUCCESS != SolveNDS_UpdateInfoInsideRef( clNDS_UpdRegionInfoUpdateInfo ) ) {
			assert( 0 );
			return FAILURE;
		}
	}
	return SUCCESS;
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: WriteAll
// Detail: 当するファイルをすべてiみzむ
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
long CNDS_UpdInfo_Writer::WriteAll( const tchar *ptcFileName, const CNDS_UpdRegionInfo &clNDS_UpdRegionInfo )
{
	if( SUCCESS != Initialize( ptcFileName ) ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != WriteNDS_UpdRegionInfo( clNDS_UpdRegionInfo) ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != SolveInsideRef() ) {
		assert( 0 );
		return FAILURE;
	}

	return SUCCESS;
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: WriteAll
// Detail: 当するファイルをすべてiみzむ
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
long CNDS_UpdInfo_Writer::WriteAll( const CNDS_UpdRegionInfo &clNDS_UpdRegionInfo )
{
	if( SUCCESS != Initialize() ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != WriteNDS_UpdRegionInfo( clNDS_UpdRegionInfo) ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != SolveInsideRef() ) {
		assert( 0 );
		return FAILURE;
	}

	return SUCCESS;
}

////////////////////////////////////////////////////////////////////////////////
//
// Function: SolveNDS_UpdateInfoInsideRef
// Detail: NDS_UpdateInfoレコ`ドの中のvS(offsetと数など)をWriteBack
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////

int CNDS_UpdInfo_Writer::SolveNDS_UpdateInfoInsideRef( CNDS_UpdInfo_NDS_UpdateInfo_InsideRef &clNDS_UpdateInfo )
{
	if( 0xFFFFFFFFFFFFFFFF != clNDS_UpdateInfo.m_ullCategoryCnt_DA ) {
		m_pclStream->SetDA( clNDS_UpdateInfo.m_ullCategoryCnt_DA );
		if( SUCCESS != m_pclStream->Put1bN( clNDS_UpdateInfo.m_uiUpdInfoList_COUNT ) ) {
			assert( 0 );
			return FAILURE;
		}
	}
	return SUCCESS;
}
