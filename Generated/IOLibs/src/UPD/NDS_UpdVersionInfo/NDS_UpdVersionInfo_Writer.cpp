
////////////////////////////////////////////////////////////////////////////////
//
// All Rights Reserved, Copyright(C),2013
// Licenced Material of by zhaoyiwei
// This file is auto generated by IOLibMaker, Do NOT modify
//
////////////////////////////////////////////////////////////////////////////////
//
// SubSystem: NDS_UpdVersionInfoNDS_UpdVersionInfoのデ`タアクセス用のライブラリ
// Class Name:    NDS_UpdVersionInfoNDS_UpdVersionInfoのきzむ用のクラス
//
////////////////////////////////////////////////////////////////////////////////
#include	"InnerCommon.h"
#include	"NDS_UpdVersionInfo_Struct.h"
#include	"NDS_UpdVersionInfo_OutsideRef.h"
#include	"NDS_UpdVersionInfo_InsideRef.h"
#include	"NDS_UpdVersionInfo_FormatStructure.h"
#include	"NDS_UpdVersionInfo_Writer.h"


////////////////////////////////////////////////////////////////////////////////
//
// Function: NDS_UpdVersionInfoNDS_UpdVersionInfoコンストラクタ`
// Detail: NDS_UpdVersionInfoNDS_UpdVersionInfoクラスの初期化
// Return:None
////////////////////////////////////////////////////////////////////////////////
CNDS_UpdVersionInfo_Writer::CNDS_UpdVersionInfo_Writer()
{
}

////////////////////////////////////////////////////////////////////////////////
//
// Function: NDS_UpdVersionInfoNDS_UpdVersionInfoコンストラクタ`
// Detail: NDS_UpdVersionInfoNDS_UpdVersionInfoクラスの初期化
// Return:None
////////////////////////////////////////////////////////////////////////////////
CNDS_UpdVersionInfo_Writer::CNDS_UpdVersionInfo_Writer( SmartPointer<CMyOfstream> &pclStream, SmartPointer<CBaseFormatStructure> &pclFormatStructure )
	: CIOLibBaseWriter( pclStream, pclFormatStructure )
{
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: NDS_UpdVersionInfoNDS_UpdVersionInfoディストラクタ`
// Detail: NDS_UpdVersionInfoNDS_UpdVersionInfoクラスの削除
// Return:None
////////////////////////////////////////////////////////////////////////////////
CNDS_UpdVersionInfo_Writer::~CNDS_UpdVersionInfo_Writer()
{
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: CreateFormatStructure
// Detail: Create meta data class of format for WriteBack.
// Return:int 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
int CNDS_UpdVersionInfo_Writer::CreateFormatStructure( SmartPointer<CBaseFormatStructure> &spclFormatStructure )
{
	spclFormatStructure.CreateEx( Type2Type<CNDS_UpdVersionInfo_FormatStructure>() );
	if( NULL == m_pclFormatStructure.Get() ) {
		assert( 0 );
		return FAILURE;
	}
	return SUCCESS;
}



////////////////////////////////////////////////////////////////////////////////
//
// Function: Write_NDS_UpdVerInfoText
// Detail: 当するフォ`マットのNDS_UpdVerInfoTextレコ`ドをきzむ
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
long CNDS_UpdVersionInfo_Writer::WriteNDS_UpdVerInfoText( const CNDS_UpdVerInfoText &clNDS_UpdVerInfoText )
{
	CFormatStructureNotifier	clNotifier( m_pclFormatStructure, StructType_NDS_UpdVersionInfo_NDS_UpdVerInfoText );

	CNDS_UpdVersionInfo_NDS_UpdVerInfoText_InsideRef 	*pclInsideRef	=	NDS_UpdVersionInfo_GetCurNDS_UpdVerInfoText_InsideRef( m_pclFormatStructure );

	pclInsideRef->m_ullSize_DA	=	m_pclStream->GetDA();
	if( SUCCESS != m_pclStream->Put2bN( clNDS_UpdVerInfoText.m_usSize ) ) {
		assert( 0 );
		return FAILURE;
	}

	uint64	ullText_REC_START_DA	=	m_pclStream->GetDA();
	if( SUCCESS != m_pclStream->PutMBCString( clNDS_UpdVerInfoText.m_strText ) ) {
		assert( 0 );
		return FAILURE;
	}
	pclInsideRef->m_ullText_SIZE	= m_pclStream->GetDA() - ullText_REC_START_DA;

	return SUCCESS;
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: Write_NDS_UpdVersionInfoDataFrame
// Detail: 当するフォ`マットのNDS_UpdVersionInfoDataFrameレコ`ドをきzむ
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
long CNDS_UpdVersionInfo_Writer::WriteNDS_UpdVersionInfoDataFrame( const CNDS_UpdVersionInfoDataFrame &clNDS_UpdVersionInfoDataFrame )
{
	CFormatStructureNotifier	clNotifier( m_pclFormatStructure, StructType_NDS_UpdVersionInfo_NDS_UpdVersionInfoDataFrame );

	CNDS_UpdVersionInfo_NDS_UpdVersionInfoDataFrame_InsideRef 	*pclInsideRef	=	NDS_UpdVersionInfo_GetCurNDS_UpdVersionInfoDataFrame_InsideRef( m_pclFormatStructure );

	pclInsideRef->m_ullSTRUCT_DA	=	m_pclStream->GetDA();
	pclInsideRef->m_ullFileSize_DA	=	m_pclStream->GetDA();
	if( SUCCESS != m_pclStream->Put4bN( clNDS_UpdVersionInfoDataFrame.m_uiFileSize ) ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != m_pclStream->Put4bN( clNDS_UpdVersionInfoDataFrame.m_uiCrc ) ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != m_pclStream->Put2bI( clNDS_UpdVersionInfoDataFrame.m_sVersionId ) ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != WriteNDS_UpdVerInfoText( clNDS_UpdVersionInfoDataFrame.m_clVersionDescrip ) ) {
		assert( 0 );
		return FAILURE;
	}

	return SUCCESS;
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: CalcSize_NDS_UpdVerInfoText
// Detail: NDS_UpdVerInfoTextをきzむSizeを算する
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
uint64 CNDS_UpdVersionInfo_Writer::CalSizeNDS_UpdVerInfoText( const CNDS_UpdVerInfoText &clNDS_UpdVerInfoText )
{
	uint64	ullResultSize	=	0;
	ullResultSize	+=	CMyOfstream::CalSize2bN( clNDS_UpdVerInfoText.m_usSize );

	uint64	ullText_REC_START_DA	=	ullResultSize;
	ullResultSize	+=	CMyOfstream::CalSizeMBCString( clNDS_UpdVerInfoText.m_strText );

	return ullResultSize;
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: CalcSize_NDS_UpdVersionInfoDataFrame
// Detail: NDS_UpdVersionInfoDataFrameをきzむSizeを算する
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
uint64 CNDS_UpdVersionInfo_Writer::CalSizeNDS_UpdVersionInfoDataFrame( const CNDS_UpdVersionInfoDataFrame &clNDS_UpdVersionInfoDataFrame )
{
	uint64	ullResultSize	=	0;
	ullResultSize	+=	CMyOfstream::CalSize4bN( clNDS_UpdVersionInfoDataFrame.m_uiFileSize );

	ullResultSize	+=	CMyOfstream::CalSize4bN( clNDS_UpdVersionInfoDataFrame.m_uiCrc );

	ullResultSize	+=	CMyOfstream::CalSize2bI( clNDS_UpdVersionInfoDataFrame.m_sVersionId );

	ullResultSize	+=	CalSizeNDS_UpdVerInfoText( clNDS_UpdVersionInfoDataFrame.m_clVersionDescrip );

	return ullResultSize;
}

////////////////////////////////////////////////////////////////////////////////
//
// Function: SolveInsideRef
// Detail: 当するフォ`マットの中のvS(offsetと数など)ををすべてWriteBack
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////

int CNDS_UpdVersionInfo_Writer::SolveInsideRef()
{
	CNDS_UpdVersionInfo_NDS_UpdVersionInfoDataFrame_InsideRef		&clNDS_UpdVersionInfoDataFrame	=	((CNDS_UpdVersionInfo_FormatStructure*)m_pclFormatStructure.Get())->GetInsideRefInfo();
	if( SUCCESS != SolveNDS_UpdVersionInfoDataFrameInsideRef( clNDS_UpdVersionInfoDataFrame ) ) {
		assert( 0 );
		return FAILURE;
	}
	{
		CNDS_UpdVersionInfo_NDS_UpdVerInfoText_InsideRef	&clNDS_UpdVersionInfoDataFrameVersionDescrip	=	clNDS_UpdVersionInfoDataFrame.m_clVersionDescrip;
		if( SUCCESS != SolveNDS_UpdVerInfoTextInsideRef( clNDS_UpdVersionInfoDataFrameVersionDescrip ) ) {
			assert( 0 );
			return FAILURE;
		}
	}
	return SUCCESS;
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: WriteAll
// Detail: 当するファイルをすべてiみzむ
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
long CNDS_UpdVersionInfo_Writer::WriteAll( const tchar *ptcFileName, const CNDS_UpdVersionInfoDataFrame &clNDS_UpdVersionInfoDataFrame )
{
	if( SUCCESS != Initialize( ptcFileName ) ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != WriteNDS_UpdVersionInfoDataFrame( clNDS_UpdVersionInfoDataFrame) ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != SolveInsideRef() ) {
		assert( 0 );
		return FAILURE;
	}

	return SUCCESS;
}


////////////////////////////////////////////////////////////////////////////////
//
// Function: WriteAll
// Detail: 当するファイルをすべてiみzむ
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////
long CNDS_UpdVersionInfo_Writer::WriteAll( const CNDS_UpdVersionInfoDataFrame &clNDS_UpdVersionInfoDataFrame )
{
	if( SUCCESS != Initialize() ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != WriteNDS_UpdVersionInfoDataFrame( clNDS_UpdVersionInfoDataFrame) ) {
		assert( 0 );
		return FAILURE;
	}

	if( SUCCESS != SolveInsideRef() ) {
		assert( 0 );
		return FAILURE;
	}

	return SUCCESS;
}

////////////////////////////////////////////////////////////////////////////////
//
// Function: SolveNDS_UpdVersionInfoDataFrameInsideRef
// Detail: NDS_UpdVersionInfoDataFrameレコ`ドの中のvS(offsetと数など)をWriteBack
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////

int CNDS_UpdVersionInfo_Writer::SolveNDS_UpdVersionInfoDataFrameInsideRef( CNDS_UpdVersionInfo_NDS_UpdVersionInfoDataFrame_InsideRef &clNDS_UpdVersionInfoDataFrame )
{
	if( 0xFFFFFFFFFFFFFFFF != clNDS_UpdVersionInfoDataFrame.m_ullFileSize_DA ) {
		m_pclStream->SetDA( clNDS_UpdVersionInfoDataFrame.m_ullFileSize_DA );
		if( SUCCESS != m_pclStream->Put4bN( clNDS_UpdVersionInfoDataFrame.m_ullSTRUCT_DA ) ) {
			assert( 0 );
			return FAILURE;
		}
	}
	return SUCCESS;
}

////////////////////////////////////////////////////////////////////////////////
//
// Function: SolveNDS_UpdVerInfoTextInsideRef
// Detail: NDS_UpdVerInfoTextレコ`ドの中のvS(offsetと数など)をWriteBack
// Return:long 型
//               SUCCESS  : (Succeeded)             
//               FAILURE : (Failed)
////////////////////////////////////////////////////////////////////////////////

int CNDS_UpdVersionInfo_Writer::SolveNDS_UpdVerInfoTextInsideRef( CNDS_UpdVersionInfo_NDS_UpdVerInfoText_InsideRef &clNDS_UpdVerInfoText )
{
	if( 0xFFFFFFFFFFFFFFFF != clNDS_UpdVerInfoText.m_ullSize_DA ) {
		m_pclStream->SetDA( clNDS_UpdVerInfoText.m_ullSize_DA );
		if( SUCCESS != m_pclStream->Put2bN( clNDS_UpdVerInfoText.m_ullText_SIZE ) ) {
			assert( 0 );
			return FAILURE;
		}
	}
	return SUCCESS;
}
